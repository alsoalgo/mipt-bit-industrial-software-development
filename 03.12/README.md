# Домашнее задание №3 к 03.12.

## Задание. 
---

Разработать ansible playbook с несколькими ролями (или несколько плейбуков):
1. Сборка приложения на "чистом" сборщике (т.е. не на хост машине с выкачиванием всех зависимостей)
2. Деплой  ваше приложение с shell скриптом его запуск. Деплой означает: проверка конфигурации сервера, установка всех необходимых компонентов, распаковка/конфигурация вашего приложения и инструмент запуска

Последовательные шаги:

1. Cоздаешь чистый контейнер куда закачиваешь исходный код своего приложения (например из git, или используешь volume) 
2. Cоздаешь чистые контейнеры для работы твоего приложения, передаешь в них только готовый артефакт (для этого используешь уже второй том volume) и запускаешь это приложение на контейрах из ансибла.

---

## Про скрипты.

### `run.sh`

Для корректного исполнения скрипта, надо из текущей директории (`./03.12`) выполнить: `cd ./scripts && ./run.sh` 

Это скрипт для запуска всего. Сначала он создает сеть `internal-net`, общий volume для `manager` & `host`: `common-dir`.   
Затем собирает образ сервера-`manager` из файла `./docker/Dockerfile`, (!!! должно быть доступно >1.08 Gb памяти на жестком диске !!!) запускает его. Аналогично поднимается сервер-`host`.   
Далее выполняются ansible-playbook'и.  

О них подробнее:
- `put_service.yml`: (выполняется на `manager`) Перекладывает исходники из `manager` в общий volume.
- `fetch_service.yml`: (выполняется на `host`) Перекладывает исходники из общего volume в `host`.
- `run_service.yml`: (выполняется на `host`) Устанавливает зависимости для сервиса, запускает его.

В скрипте дополнительно выводятся логи, поясняющие происходящее, а также содержатся комментарии, которые дополнительно поясняют выполняемые команды.

### `clean.sh`

Скрипт для очистки. Останавливает контейнеры, удаляет их образы, удаляет общий volume, удаляет сеть `internal-net`.

Для корректного исполнения скрипта, надо из текущей директории (`./03.12`) выполнить: `cd ./scripts && ./clean.sh` 

